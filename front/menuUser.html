<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Usuario</title>

  <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyCw8ae27O1Bg8MNBZDKrB55jciUld6plOc",
          authDomain: "becauaqbd.firebaseapp.com",
          projectId: "becauaqbd",
          storageBucket: "becauaqbd.firebasestorage.app",
          messagingSenderId: "853997069826",
          appId: "1:853997069826:web:50e1a3812626cf4255a91b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        window.firebaseApp = app;
        window.firebaseDB = db;
        window.firebaseModules = { collection, query, where, getDocs };
    </script>

  <style>
    :root {
      --azul: #44658a;
      --fondo: #e9fdfd;
      --caja: white;
      --borde-radio: 18px;
    }

    body {
      margin: 0;
      background: var(--fondo);
      font-family: "Segoe UI", sans-serif;
      color: black;
    }

    /* Header */
    .header {
      background-color: var(--azul);
      color: white;
      padding: 18px 30px;
      border-bottom-left-radius: 45px;
      border-bottom-right-radius: 45px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-icon {
      width: 55px;
      height: 55px;
      background: #b9ecf5;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: var(--azul);
    }

    .home-icon {
      background: var(--azul);
      border: 2px solid white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      cursor: pointer;
      font-size: 25px;
    }

    /* Contenido */
    .content {
      padding: 25px;
      margin-bottom: 90px;
    }

    .section {
      display: none;
      background: var(--caja);
      padding: 20px;
      border-radius: var(--borde-radio);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .active {
      display: block;
    }

    /* Footer */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--azul);
      padding: 12px;
      display: flex;
      justify-content: space-around;
      color: white;
      border-top-left-radius: 25px;
      border-top-right-radius: 25px;
    }

    .footer button {
      background: none;
      border: none;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }

    .footer button:hover {
      text-decoration: underline;
    }
    
    /* Estilos espec√≠ficos para la secci√≥n de renovaci√≥n */
    #renovacion .container {
      max-width: 900px;
      margin: 0 auto;
    }

    #renovacion .data-box {
      background: #fff;
      border-left: 10px solid #44658a;
      padding: 18px;
      border-radius: 8px;
      box-shadow: 0 3px 8px rgba(0,0,0,.12);
      margin-bottom: 18px;
      display: flex;
      gap: 16px;
      align-items: center;
    }

    #renovacion .avatar {
      width: 72px;
      height: 72px;
      border-radius: 10px;
      object-fit: cover;
      border: 2px solid #e6f3f7;
      background: #fff;
    }

    #renovacion .data-box .info p {
      margin: 6px 0;
      font-size: 1em;
      color: #222;
    }

    #renovacion #estadoBeca {
      font-weight: 700;
    }

    #renovacion .option-box {
      background: #fff;
      border-left: 10px solid #00a1a7;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 3px 8px rgba(0,0,0,.08);
    }

    #renovacion .radio-group {
      display: flex;
      gap: 28px;
      font-size: 1.05em;
      margin-top: 6px;
    }

    #renovacion input[type="radio"] {
      transform: scale(1.15);
      margin-right: 8px;
    }

    #renovacion .file-upload {
      margin-top: 14px;
      display: none;
    }

    #renovacion input[type="file"] {
      padding: 12px;
      border: 2px solid #44658a;
      background: #e8f9fb;
      border-radius: 10px;
      width: 100%;
      cursor: pointer;
    }

    #renovacion .btn {
      margin-top: 20px;
      background: #44658a;
      color: #fff;
      border: none;
      width: 100%;
      height: 46px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.05em;
    }

    #renovacion .btn:hover {
      background: #35506d;
    }

    #renovacion .alert {
      display: none;
      padding: 12px 18px;
      border-radius: 8px;
      color: #fff;
      text-align: center;
      margin-top: 14px;
      font-weight: 600;
    }

    #renovacion .state-pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 700;
    }

    /* Estilos para PDF viewers */
    .pdf-viewer {
      width: 100%;
      height: 600px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .form-container {
      margin: 20px 0;
    }

    .buttons {
      margin-top: 15px;
      text-align: center;
    }

    .buttons button {
      background-color: var(--azul);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 10px;
    }
  </style>

</head>

<body>

  <div class="header">
    <div class="user-info">
      <div class="user-icon">üë§</div>
      <div>
        <div><strong id="userName">Usuario</strong></div>
        <div id="userId">ID-Usuario</div>
      </div>
    </div>

    <div class="home-icon" onclick="showSection('inicio')">üè†</div>
  </div>

  <div class="content">

    <!-- home -->
    <div id="inicio" class="section active">
      <h2>Bienvenido</h2>
      <p>Seleccione una opci√≥n del men√∫ inferior.</p>
    </div>

    <!-- Convocatorias -->
    <div id="convocatoria" class="section">
      <h2>Convocatoria</h2>
      <div class="form-container">
        <iframe class="pdf-viewer" src="/uploads/convocatoria.pdf"></iframe>
        <div class="buttons">
          <button onclick="window.location.href='/descargar-convocatoria'">Descargar PDF</button>
        </div>
      </div>
    </div>

    <!-- Registro -->
    <div id="registro" class="section">
      <h2>Registro</h2>
      <p>Formulario de registro.</p>
    </div>

    <!-- Renovaci√≥n -->
    <div id="renovacion" class="section">
    <h2>Renovaci√≥n</h2>
    <div class="container">
            <!-- DATOS DEL BECARIO -->
            <div class="data-box">
                <img class="avatar" src="/mnt/data/A_2D_digital_design_of_a_user_interface_for_a_scho.png" alt="avatar">
                <div class="info">
                    <p><strong>Nombre:</strong> <span id="renovacionNombre">Cargando...</span></p>
                    <p><strong>Matr√≠cula:</strong> <span id="renovacionMatricula">Cargando...</span></p>
                    <p><strong>Carrera:</strong> <span id="renovacionCarrera">Cargando...</span></p>
                    <p><strong>Estado de Beca Actual:</strong>
                        <span id="renovacionEstadoBeca" class="state-pill">Cargando...</span>
                    </p>
                </div>
            </div>

            <!-- OPCIONES -->
            <div class="option-box">
                <h3 style="margin:0;color:#24496f;">Solicitud de Renovaci√≥n</h3>
                <p style="margin:8px 0 6px;color:#444;">Seleccione una opci√≥n y env√≠e su solicitud. Si elige <em>S√≠</em>, su estado cambiar√° a <strong>Pendiente</strong> hasta que un administrador apruebe.</p>

                <div class="radio-group">
                    <label><input type="radio" name="renovar" value="si"> S√≠ deseo renovar</label>
                    <label><input type="radio" name="renovar" value="no"> No deseo renovar</label>
                </div>

                <div class="file-upload" id="uploadSection">
                    <p style="margin:10px 0 6px;"><strong>Suba el documento (PDF) para renovar:</strong></p>
                    <input id="docFile" type="file" accept="application/pdf" />
                </div>

                <button class="btn" onclick="enviarRenovacion()">Enviar renovaci√≥n</button>

                <div id="alertBox" class="alert"></div>
            </div>
        </div>
    </div>

    <!-- Resultados -->
    <div id="resultados" class="section">
      <h2>Resultados</h2>
      <div class="form-container">
        <iframe class="pdf-viewer" src="/uploads/resultados.pdf"></iframe>
        <div class="buttons">
          <button onclick="window.location.href='/descargar-resultados'">Descargar PDF</button>
        </div>
      </div>
    </div>

    <!-- Acerca de -->
    <div id="acerca" class="section">
      <h2>Acerca</h2>
      <div class="content">
        <p>La Aplicaci√≥n de Becas UAQ es un proyecto desarrollado como parte del Proyecto Final de Redes de la Facultad de Inform√°tica de la Universidad Aut√≥noma de Quer√©taro, dentro del programa educativo de Ingenier√≠a de Software.</p>
        <p>Su objetivo principal es brindar una soluci√≥n digital que facilite la gesti√≥n y administraci√≥n de informaci√≥n relacionada con becas estudiantiles, permitiendo a la universidad mantener procesos ordenados, accesibles y eficientes tanto para los estudiantes como para los administradores del sistema.</p>
        <p>Este proyecto surge como respuesta a una problem√°tica com√∫n: la desorganizaci√≥n en los procesos de becas y la falta de comunicaci√≥n clara sobre el estado de las solicitudes. La aplicaci√≥n ofrece una plataforma donde los alumnos pueden consultar el estado de sus entrevistas, documentos y resultados, mientras que los administradores pueden gestionar convocatorias, validar aplicantes y controlar el flujo completo del proceso.</p>
        <p>Para su desarrollo se utilizaron tecnolog√≠as como <b>HTML, CSS, JavaScript, PHP y XAMPP</b>, adem√°s de herramientas de dise√±o como <b>Figma</b> para la creaci√≥n de prototipos y <b>GitHub</b> para la colaboraci√≥n del equipo durante el desarrollo.</p>
        <p>El sistema plantea diferentes vistas seg√∫n el tipo de usuario: estudiantes, administradores suplentes y administradores principales, cada uno con permisos y funciones espec√≠ficas.</p>
        <p>La aplicaci√≥n est√° dise√±ada como un proyecto funcional, modular y escalable, con la capacidad de crecer y adaptarse a necesidades reales dentro del entorno universitario.</p>
      </div>
    </div>

  </div>

  <div class="footer">
    <button onclick="showSection('convocatoria')">Convocatoria</button>
    <button onclick="showSection('registro')">Registro</button>
    <button onclick="showSection('renovacion')">Renovaci√≥n</button>
    <button onclick="showSection('resultados')">Resultados</button>
    <button onclick="showSection('acerca')">Acerca</button>
  </div>

  <script>
    function showSection(id) {
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // Cargar datos del usuario
    async function cargarDatosUsuario() {
      try {
          const usuarioStorage = localStorage.getItem('usuario');
          if (!usuarioStorage) {
              window.location.href = 'index.html';
              return;
          }

          const usuarioData = JSON.parse(usuarioStorage);
          
          // Actualizar header
          const userNameElement = document.getElementById('userName');
          const userIdElement = document.getElementById('userId');

          if (usuarioData.nombre) {
              userNameElement.textContent = usuarioData.nombre;
          }
          if (usuarioData.id) {
              userIdElement.textContent = `ID: ${usuarioData.id}`;
          }

          // Cargar datos espec√≠ficos para renovaci√≥n
          cargarDatosRenovacion(usuarioData);

      } catch (error) {
          console.error('Error al cargar datos del usuario:', error);
      }
    }

    function cargarDatosRenovacion(usuarioData) {
    try {
        console.log('üìä Cargando datos para renovaci√≥n:', usuarioData);
        
        // Actualizar los elementos espec√≠ficos de renovaci√≥n
        const nombreElement = document.getElementById('renovacionNombre');
        const matriculaElement = document.getElementById('renovacionMatricula');
        const carreraElement = document.getElementById('renovacionCarrera');
        const estadoElement = document.getElementById('renovacionEstadoBeca');
        
        // Nombre
        if (usuarioData.nombre) {
            nombreElement.textContent = usuarioData.nombre;
        } else {
            nombreElement.textContent = 'No disponible';
        }
        
        // Matr√≠cula (usamos el ID como matr√≠cula)
        if (usuarioData.id) {
            matriculaElement.textContent = usuarioData.id;
        } else {
            matriculaElement.textContent = 'No disponible';
        }
        
        // Carrera
        if (usuarioData.carrera) {
            carreraElement.textContent = usuarioData.carrera;
        } else {
            carreraElement.textContent = 'No especificada';
        }
        
        // Estado de beca
        if (usuarioData.estado_beca) {
            estadoElement.textContent = usuarioData.estado_beca;
            
            // Aplicar estilos seg√∫n el estado
            if (usuarioData.estado_beca === 'Activa') {
                estadoElement.style.color = 'green';
                estadoElement.style.background = '#e6f5f5';
                estadoElement.style.border = '1px solid #cfecec';
            } else if (usuarioData.estado_beca === 'Inactiva') {
                estadoElement.style.color = 'red';
                estadoElement.style.background = '#fde8e8';
                estadoElement.style.border = '1px solid #fbd5d5';
            } else if (usuarioData.estado_beca === 'Pendiente') {
                estadoElement.style.color = 'orange';
                estadoElement.style.background = '#fff3e6';
                estadoElement.style.border = '1px solid #ffe0b3';
            }
        } else {
            estadoElement.textContent = 'No disponible';
            estadoElement.style.color = 'gray';
            estadoElement.style.background = '#f5f5f5';
            estadoElement.style.border = '1px solid #ddd';
        }
        
        console.log('‚úÖ Datos de renovaci√≥n cargados correctamente');
        
    } catch (error) {
        console.error('‚ùå Error al cargar datos de renovaci√≥n:', error);
    }
    }

    // L√≥gica para mostrar/ocultar upload seg√∫n selecci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      cargarDatosUsuario();
      
      // Mostrar secci√≥n de upload solo cuando seleccionan "S√≠"
      const radios = document.querySelectorAll('input[name="renovar"]');
      const uploadSection = document.getElementById('uploadSection');
      
      radios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'si') {
            uploadSection.style.display = 'block';
          } else {
            uploadSection.style.display = 'none';
          }
        });
      });
    });

    function enviarRenovacion() {
      const selectedOption = document.querySelector('input[name="renovar"]:checked');
      const alertBox = document.getElementById('alertBox');
      
      if (!selectedOption) {
        alertBox.textContent = 'Por favor seleccione una opci√≥n';
        alertBox.style.backgroundColor = '#ff6b6b';
        alertBox.style.display = 'block';
        return;
      }
      
      if (selectedOption.value === 'si') {
        const fileInput = document.getElementById('docFile');
        if (!fileInput.files.length) {
          alertBox.textContent = 'Por favor suba el documento PDF';
          alertBox.style.backgroundColor = '#ff6b6b';
          alertBox.style.display = 'block';
          return;
        }
        alertBox.textContent = 'Solicitud de renovaci√≥n enviada correctamente';
        alertBox.style.backgroundColor = '#51cf66';
      } else {
        alertBox.textContent = 'Ha decidido no renovar su beca';
        alertBox.style.backgroundColor = '#ffa94d';
      }
      
      alertBox.style.display = 'block';
    }

    // Verificar que el usuario est√© logueado
    if (!localStorage.getItem('usuario')) {
      window.location.href = 'index.html';
    }
  </script>

</body>
</html>